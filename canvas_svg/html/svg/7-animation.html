<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>动画</title>
    <link rel="stylesheet" href="../../css/note.css"/>
</head>
<style></style>
<body>

<div class="pg-wrapper">


    <h3 class="sub-title">七 、 动画</h3>

    <section>
        <h4 class="title-level-1">7-1 、SMIL for SVG</h4>

        <div class="des bg-light level-1">

            <dl>
                <dt>• 参考资料</dt>
                <dd><a href="http://www.w3.org/TR/SVG/animate.html" target="_blank">‣ http://www.w3.org/TR/SVG/animate.html</a></dd>
                <dd><a href="http://www.zhangxinxu.com/wordpress/?p=4333" target="_blank">‣ http://www.zhangxinxu.com/wordpress/?p=4333</a></dd>
            </dl>

            <dl>
                <dt>• 动画标签</dt>
                <dd>‣ <xmp style="display: inline;"><animate>、<animateTransform>、<animateMotion>...</xmp></dd>
            </dl>

            <dl>
                <dt>• 动画元素、属性定位以及动画参数设置</dt>
                <dd>‣ attributeName、attributeType</dd>
                <dd>‣ from、to、dur、repeatCount、fill...</dd>
                <dd>‣ calcMode...</dd>
            </dl>

        </div>


        <div class="des bg-light level-1">

            <h4 class="title-level-2">定位动画目标（不支持css transform）</h4>


            <dl>

                <dt>• Internal Resource Identifier 定位</dt>
                <dd style="background: #fff;" class="eg-wrapper">
                    <pre>
        <xmp>
            ‣ <animate xlink:href="url(#rect1)"></animate>
        </xmp>
                    </pre>
                </dd>
            </dl>

            <dl>

                <dt>• 被包含在目标元素里</dt>
                <dd style="background: #fff;" class="eg-wrapper">
                    <pre>
                        <xmp>
        ‣ <rect x="0" ...>
            <animate>...</animate>
        </rect>
                        </xmp>
                    </pre>
                </dd>
            </dl>

        </div>


        <div class="des bg-light level-1">

            <h4 class="title-level-2">SMIL for SVG - 基本动画</h4>


            <dl>

                <dt>• 设置要进行动画的属性以及变化范围、时间长度</dt>

                <dd style="background: #fff;" class="eg-wrapper">
                    <pre>
                        <xmp>
          ‣ <animate xlink:href="url(#rect1)"
                   attributeType="XML"   ————取值可以是xml也可以是css
                   attributeName="x"
                   from="10"
                   to="110"
                   dur="3s">
            </animate>
                        </xmp>
                    </pre>
                </dd>

            </dl>


            <dl>
                <div style="background: #fff;" class="eg-wrapper">
                    <pre data-lang="code" class="close">
                        <xmp>
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 width="100%" height="100%"
                                 class="bg-white"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                                <rect x="100" y="100" fill="red" width="100" height="50">
                                    <animate id="goright"
                                             attributeType="XML"
                                             attributeName="x"
                                             begin="0; goleft.end + 2s"
                                             from="100"
                                             to="500"
                                             dur="3s"
                                             fill="freeze"
                                             repeatCount="2">

                                    </animate>

                                    <animate id="goleft"
                                             attributeType="XML"
                                             attributeName="x"
                                             begin="goright.end"
                                             from="500"
                                             to="100"
                                             dur="3s"
                                             fill="freeze"
                                             repeatCount="2">

                                    </animate>

                                    <animate
                                            attributeType="XML"
                                            attributeName="fill"
                                            from="red"
                                            to="grey"
                                            dur="3s"
                                            fill="freeze">

                                    </animate>

                                    <animate
                                            attributeType="XML"
                                            attributeName="y"
                                            from="100"
                                            to="200"
                                            dur="3s"
                                            fill="freeze"
                                            repeatCount="indefinite">

                                    </animate>
                                </rect>

                            </svg>
                        </xmp>
                    </pre>
                </div>
            </dl>

            <dl>
                <div style="height: 400px">

                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="100%" height="100%"
                        class="bg-white"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                        <rect x="100" y="100" fill="red" width="100" height="50">
                            <animate id="goright"
                                attributeType="XML"
                                attributeName="x"
                                 begin="0; goleft.end + 2s"
                                from="100"
                                to="500"
                                dur="3s"
                                fill="freeze"
                                repeatCount="2">

                            </animate>

                            <animate id="goleft"
                                     attributeType="XML"
                                     attributeName="x"
                                     begin="goright.end"
                                     from="500"
                                     to="100"
                                     dur="3s"
                                     fill="freeze"
                                     repeatCount="2">

                            </animate>

                            <animate
                                    attributeType="XML"
                                    attributeName="fill"
                                    from="red"
                                    to="grey"
                                    dur="3s"
                                    fill="freeze">

                            </animate>

                            <animate
                                    attributeType="XML"
                                    attributeName="y"
                                    from="100"
                                    to="200"
                                    dur="3s"
                                    fill="freeze"
                                    repeatCount="indefinite">

                            </animate>
                        </rect>

                    </svg>

                </div>

            </dl>


        </div>

        <div class="des bg-light level-1">

            <h4 class="title-level-2">SMIL for SVG - 变换动画(transform)</h4>


            <dl>

                <dt>• 设置要进行动画的属性以及变化范围、时间长度(不能叠加)</dt>

                <dd style="background: #fff;" class="eg-wrapper">
                    <pre>
                        <xmp>
      ‣ <animateTransform xlink:href="url(#rect1)"
            type="translate"
            from="0 0"
            to="100 100"
            dur="3s">
        </animateTransform>
                        </xmp>
                    </pre>
                </dd>

            </dl>


            <dl>
                <div style="background: #fff;" class="eg-wrapper">
                    <pre data-lang="code" class="close">
                        <xmp>
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 width="100%" height="100%"
                                 class="bg-white"
                                 viewBox="-400 -300 800 600"
                                 preserveAspectRatio="xMidYMid meet"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                                <rect x="100" y="100" fill="red" width="100" height="50" >

                                    <animateTransform id="rotate"
                                                      attributeType="XML"
                                                      attributeName="transform"
                                                      type="rotate"
                                                      from="0"
                                                      to="360"
                                                      dur="2s"
                                                      fill="freeze"
                                                      repeatCount="indefinite">
                                    </animateTransform>



                                </rect>

                            </svg>
                        </xmp>
                    </pre>
                </div>
            </dl>

            <dl>
                <div style="height: 400px">

                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="100%" height="100%"
                         class="bg-white"
                         viewBox="-400 -300 800 600"
                         preserveAspectRatio="xMidYMid meet"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                        <rect x="100" y="100" fill="red" width="100" height="50" >

                            <animateTransform id="rotate"
                                              attributeType="XML"
                                              attributeName="transform"
                                              type="rotate"
                                              from="0"
                                              to="360"
                                              dur="2s"
                                              fill="freeze"
                                              repeatCount="indefinite">
                            </animateTransform>



                        </rect>

                    </svg>

                </div>

            </dl>


        </div>

        <div class="des bg-light level-1">

            <h4 class="title-level-2">轨迹移动</h4>


            <dl>

                <dt>• 设置轨迹路径</dt>

                <dd style="background: #fff;" class="eg-wrapper">
                    <pre>
                        <xmp>
                            ‣ <animateMotion xlink:href="url(#rect1)"
                                             path="M0,0h100v100h-100v-100z"
                                             rotate="auto"
                                             dur="3s">
                            </animateMotion>
                        </xmp>
                    </pre>
                </dd>

            </dl>


            <dl>
                <div style="background: #fff;" class="eg-wrapper">
                    <pre data-lang="code" class="close">
                        <xmp>
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 width="100%" height="100%"
                                 class="bg-white"
                                 viewBox="-400 -300 800 600"
                                 preserveAspectRatio="xMidYMid meet"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                                <rect x="-25" y="-25" fill="red" width="50" height="50" >
                                    <animateMotion
                                            path="M 0 0L100 100A 200 200 0 1 0 0 -100"
                                            dur="3s"
                                            rotate="auto"
                                            repeatCount="indefinite"></animateMotion>
                                </rect>
                                <path id="motion-path" d="M 0 0L100 100A 200 200 0 1 0 0 -100"  fill="none" stroke="blue"></path>


                            </svg>
                        </xmp>
                    </pre>
                </div>
            </dl>

            <dl>
                <div style="background: #fff;" class="eg-wrapper">
                    <pre data-lang="code" class="close">
                        <xmp>
                            <svg xmlns="http://www.w3.org/2000/svg"
                                 width="100%" height="100%"
                                 class="bg-white"
                                 viewBox="-400 -300 800 600"
                                 preserveAspectRatio="xMidYMid meet"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                                <rect x="-25" y="-25" fill="red" width="50" height="50" >
                                    <animateMotion
                                            dur="3s"
                                            rotate="auto"
                                            repeatCount="indefinite">
                                        <mpath xlink:href="#motion-path"></mpath>
                                    </animateMotion>
                                </rect>
                                <path id="motion-path" d="M 0 0L100 100A 200 200 0 1 0 0 -100"  fill="none" stroke="blue"></path>


                            </svg>
                        </xmp>
                    </pre>
                </div>
            </dl>

            <dl>
                <div style="height: 400px">

                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="100%" height="100%"
                         class="bg-white"
                         viewBox="-400 -300 800 600"
                         preserveAspectRatio="xMidYMid meet"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                        <rect x="-25" y="-25" fill="red" width="50" height="50" >
                            <animateMotion
                                dur="3s"
                                rotate="auto"
                                repeatCount="indefinite">
                               <mpath xlink:href="#motion-path"></mpath>
                            </animateMotion>
                        </rect>
                        <path id="motion-path" d="M 0 0L100 100A 200 200 0 1 0 0 -100"  fill="none" stroke="blue"></path>


                    </svg>

                </div>

            </dl>


        </div>


    </section>

    <section>
        <h4 class="title-level-1">7-2 、 Scripting Animation</h4>

        <div class="des bg-light level-1">

            <dl>
                <dt>• 核心思想</dt>
                <dd>‣ requestAnimationFrame(update)</dd>
            </dl>

            <dl>
                <dt>• 示例</dt>
                <dd>‣ 力导向图</dd>
            </dl>

        </div>

        <div class="des bg-light level-1">

            <svg xmlns="http://www.w3.org/2000/svg"
                 width="450px" height="560px"
                 class="bg-white level-1"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->

                <polyline points=" 300 120 100 320 240 450" fill="none" stroke="#777"></polyline>

                <circle cx="300" cy="120" r="30" fill="#7BDB45"></circle>
                <circle cx="100" cy="320" r="25" fill="#E8A433"></circle>
                <circle cx="240" cy="450" r="22" fill="#1497FC"></circle>

                <text x="60" y="200" fill="#A52B1B" font-size="24px">弹簧模型</text>


            </svg>

            <div style="display: inline-block; vertical-align: top">
                <dl>
                    <dt>• 两个点之间：</dt>
                    <dd>‣ Fi = k · xi (假设弹性系数是⼀一样的)</dd>
                </dl>

                <dl>
                    <dt>• 可以计算合⼒</dt>
                    <dd>‣ F = ΣFi</dd>
                </dl>

                <dl>
                    <dt>• 加速度</dt>
                    <dd>‣ a = F / m （可以假设每个点质量⼀一样）</dd>
                </dl>

                <dl>
                    <dt>• 速度</dt>
                    <dd>‣ v = v0 + a · Δt (Δt 为⼀一帧的时间) </dd>
                </dl>

                <dl>
                    <dt>• 位移</dt>
                    <dd>‣ s = s0 + v · Δt</dd>
                </dl>

            </div>



        </div>

        <div class="des bg-light level-1">

            <p class="level-1">力导向图</p>

            <dl>
                <div style="background: #fff;" class="eg-wrapper">
                    <pre data-lang="code" class="close">
                        <xmp>
                        </xmp>
                    </pre>
                </div>
            </dl>

            <dl>
                <div id="force" style="height: 700px">

                    <svg xmlns="http://www.w3.org/2000/svg"
                         width="100%" height="100%"
                         viewBox="-400 -300 800 600"
                         preserveAspectRatio="xMidYMid meet"
                        class="bg-white"><!--meet 相当于 background-size: contain; slice 相当于 background-size: cover;-->
                        <path id="links" fill="none" stroke="grey"></path>


                    </svg>

                    <script>

                        (function(){

                            //定义矢量
                            function Vector(x, y){
                                this.x = x || 0;
                                this.y = y || 0;
                            }

                            Vector.prototype = {
                                constructor : Vector,
                                square : function(){
                                    return this.x * this.x + this.y * this.y;
                                },
                                length : function(){
                                    return Math.sqrt(this.square());
                                },
                                add : function(q){
                                    return new Vector(this.x + q.x, this.y + q.y);
                                },
                                minus : function(q){
                                    return new Vector(this.x - q.x, this.y - q.y);
                                },
                                multipy : function(scale){
                                    return new Vector(this.x * scale, this.y * scale);
                                },
                                normalize : function(length){
                                    if(length === undefined){
                                        length = 1;
                                    }
                                    return this.multipy(length / this.length());
                                },

                            };

                            Vector.fromPoints = function(p1, p2){
                                return new Vector(p2.x - p1.x, p2.y - p1.y);
                            };

                            window.Vector = Vector;

                        })();

                        (function(){
                            var points = 'a,b,c,d,e,f,g,h'.split(',').map(function(name, index, arr){
                                return {
                                    name: name,
                                    color : 'hsl(' + (360 * index / arr.length) + ', 100%, 60%'
                                };
                            });
                            var relation = 300;
                            var k = 0.05;
                            var svg = force.querySelector('svg');


                            var Vector = window.Vector;

                            function random(min, max){
                                return Math.round(min + (max - min) * Math.random());
                            }

                            points.forEach(function(point){

                                var circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                                var x = random(-400 + 10, 400 -10);
                                var y = random(-300 + 10, 300 -10);

                                circle.setAttribute('cx', x);
                                circle.setAttribute('cy', y);
                                circle.setAttribute('r', 10);
                                circle.setAttribute('fill', point.color);

                                point.circle = circle;
                                point.s = new Vector(x, y);
                                point.v = new Vector();
                                point.a = new Vector();

                                svg.appendChild(circle);


                            });

                            var lastFrameTime = +new Date();

                            function update(){
                                var frameTime = +new Date();
                                var t = frameTime - lastFrameTime;

                                t /= 100;

                                //点位置更新
                                points.forEach(function(pa){
                                    var f = new Vector();

                                    //计算合力
                                    points.forEach(function(pb){
                                        if(pa == pb) return;

                                        var x = Vector.fromPoints(pa.s, pb.s);
                                        var delta = x.length() - relation;
                                        // f = k * x

                                        f = f.add(x.normalize(delta * k));
                                    });

                                    pa.a = f;
                                    pa.v = pa.v.add(pa.a.multipy(t)).multipy(0.98);
                                    pa.s = pa.s.add(pa.v.multipy(t));

                                    pa.circle.setAttribute('cx', pa.s.x);
                                    pa.circle.setAttribute('cy', pa.s.y);

                                });

                                //连线更新
                                var linkPath = [];
                                points.forEach(function(pa){
                                    var sa = pa.s;
                                    points.forEach(function(pb){
                                        if(pa==pb)return;
                                        var sb = pb.s;
                                        linkPath = linkPath.concat([
                                            'M' , sa.x, sa.y,
                                            'L' , sb.x, sb.y,
                                        ])
                                    });
                                });
                                document.getElementById('links').setAttribute('d', linkPath.join(' '));


                                lastFrameTime = frameTime;
                                window.requestAnimationFrame(update);

                            }

                            window.requestAnimationFrame(update);



                        })();

                    </script>

                </div>

            </dl>

        </div>

    </section>


</div>

</body>

<script>
    window.onload = function(){
        var body = document.getElementsByTagName('body')[0];
        body.onclick = function(e){
            var element = e.target;
//            console.log(element.tagName.toLowerCase());
            if(element.tagName.toLowerCase() == 'pre' && element.dataset.lang){

//                   'close'
//                console.log(element.className.indexOf('close'))


                if(element.className.indexOf('close') != -1){
                    element.className = element.className.replace(/close/,"");
                }else{
                    element.className += ' close';
                };



            }
        }
    };
</script>

</html>

















































